<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EthOS Sliding Puzzle</title>
  <style>
    @font-face {
      font-family: 'ChicagoGT';
      src: url('cfont.ttf') format('truetype');
    }
    body {
      font-family: 'ChicagoGT', monospace;
      background-color: #a6c1ee;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
      text-align: center;
    }
    .retro-btn {
      font-family: inherit;
      font-size: 16px;
      padding: 10px 20px;
      background: #e0e0e0;
      border: 2px solid;
      border-top-color: #fff;
      border-left-color: #fff;
      border-bottom-color: #404040;
      border-right-color: #404040;
      cursor: pointer;
      margin: 5px;
    }
    .popup, #overlay { display: none; }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #f0f0f0;
      border: 4px solid #000;
      padding: 20px;
      z-index: 1000;
      box-shadow: inset -3px -3px #fff, inset 3px 3px #555;
    }
    #overlay {
      position: fixed;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      top: 0;
      left: 0;
      z-index: 900;
    }
    .template-grid {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      max-width: 90vw;
    }
    .template-item {
      width: 150px;
      background: #dcdcdc;
      border: 2px solid #000;
      padding: 6px;
      text-align: center;
      flex-shrink: 0;
    }
    .template-item img {
      width: 100%;
    }
    #puzzleBoard {
      display: grid;
      margin-top: 20px;
      border: 4px solid #000;
      max-width: 95vw;
    }
    .tile {
      background-size: 100% 100%;
      background-repeat: no-repeat;
      border-radius: 25%;
      box-shadow: inset 0 0 4px #444;
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .empty {
      background: transparent;
      box-shadow: none;
    }
    #infoBar {
      margin-top: 10px;
      font-size: 18px;
    }
    #winPopup {
      display: none;
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 4px solid #000;
      padding: 20px;
      z-index: 1001;
      font-size: 20px;
      box-shadow: inset -3px -3px #fff, inset 3px 3px #555;
    }
  </style>
</head>
<body>
  <h1>ðŸ§© EthOS Puzzle</h1>
  <div>
    <button class="retro-btn" onclick="openTemplatePopup()">Choose Template</button>
    <button class="retro-btn" onclick="openModePopup()">Mode</button>
    <button class="retro-btn" onclick="startGame()">Start Game</button>
    <button class="retro-btn" onclick="resetGame()">Reset</button>
  </div>
  <div id="infoBar">Time: <span id="timer">0</span>s | Score: <span id="score">0</span></div>
  <div id="puzzleBoard"></div>
  <div id="overlay" onclick="closePopups()"></div>
  <div id="templatePopup" class="popup">
    <div class="template-grid" id="templateList"></div>
  </div>
  <div id="modePopup" class="popup">
    <h3>Select Puzzle Mode</h3>
    <button class="retro-btn" onclick="selectMode(3)">3 x 3</button>
    <button class="retro-btn" onclick="selectMode(6)">6 x 6</button>
    <button class="retro-btn" onclick="selectMode(10)">10 x 10</button>
  </div>
  <div id="winPopup">ðŸŽ‰Congratulation! You nailed it! ðŸŽ‰</div>
  <script>
    const templates = [
      { name: "EthOS Original", file: "ethos-original.jpg" },
      { name: "EthOS Psychedelic Flowers", file: "ethos-psychedelic-flowers.png" },
      { name: "EthOS Psychedelic Sea", file: "ethos-psychedelic-sea.png" },
      { name: "EthOS Psychedelic Forest", file: "ethos-psychedelic-forest.png" },
      { name: "EthOS Psychedelic City", file: "ethos-psychedelic-city.png" },
      { name: "EthOS Psychedelic Garden", file: "ethos-psychedelic-garden.png" },
      { name: "EthOS Surreal Alchemy", file: "ethos-surreal-alchemy.png" },
      { name: "EthOS Surreal Garden", file: "ethos-surreal-garden.png" },
      { name: "EthOS Surreal Animals", file: "ethos-surreal-animals.png" }
    ];
    let puzzleSize = 3;
    let selectedTemplate = templates[0].file;
    let timer = 0;
    let interval = null;
    let score = 0;
    let currentOrder = [];
    let correctOrder = [];
    const puzzleBoard = document.getElementById("puzzleBoard");
    const timerDisplay = document.getElementById("timer");
    const scoreDisplay = document.getElementById("score");
    const templateList = document.getElementById("templateList");
    templates.forEach(tpl => {
      const div = document.createElement("div");
      div.className = "template-item";
      div.innerHTML = `<img src="${tpl.file}" />
        <div>${tpl.name}</div>
        <button class="retro-btn" onclick="selectTemplate('${tpl.file}')">Select</button>`;
      templateList.appendChild(div);
    });
    function selectTemplate(file) {
      selectedTemplate = file;
      closePopups();
    }
    function selectMode(size) {
      puzzleSize = size;
      closePopups();
    }
    function openTemplatePopup() {
      document.getElementById("templatePopup").style.display = "block";
      document.getElementById("overlay").style.display = "block";
    }
    function openModePopup() {
      document.getElementById("modePopup").style.display = "block";
      document.getElementById("overlay").style.display = "block";
    }
    function closePopups() {
      document.querySelectorAll('.popup').forEach(p => p.style.display = 'none');
      document.getElementById("overlay").style.display = "none";
    }
    function resetGame() {
      clearInterval(interval);
      startGame();
    }
    function startGame() {
      timer = 0;
      score = 0;
      currentOrder = [];
      correctOrder = [];
      timerDisplay.textContent = timer;
      scoreDisplay.textContent = score;
      clearInterval(interval);
      interval = setInterval(() => {
        timer++;
        timerDisplay.textContent = timer;
      }, 1000);
      generatePuzzle();
    }
    function generatePuzzle() {
      puzzleBoard.innerHTML = "";
      puzzleBoard.style.gridTemplateColumns = `repeat(${puzzleSize}, 1fr)`;
      const total = puzzleSize * puzzleSize;
      const tiles = Array.from({ length: total }, (_, i) => i);
      correctOrder = [...tiles];
      let shuffled = [...tiles];
      do {
        shuffled.sort(() => Math.random() - 0.5);
      } while (!isSolvable(shuffled));
      currentOrder = [...shuffled];
      const tileSize = 420 / puzzleSize;
      puzzleBoard.style.width = puzzleBoard.style.height = `${tileSize * puzzleSize}px`;
      shuffled.forEach((val, index) => {
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.style.width = tile.style.height = `${tileSize}px`;
        tile.dataset.index = index;
        if (val === total - 1) {
          tile.classList.add("empty");
        } else {
          const x = val % puzzleSize;
          const y = Math.floor(val / puzzleSize);
          tile.style.backgroundImage = `url(${selectedTemplate})`;
          tile.style.backgroundSize = `${puzzleSize * 100}% ${puzzleSize * 100}%`;
          tile.style.backgroundPosition = `${(x / (puzzleSize - 1)) * 100}% ${(y / (puzzleSize - 1)) * 100}%`;
        }
        tile.addEventListener("click", () => moveTile(index));
        puzzleBoard.appendChild(tile);
      });
    }
    function moveTile(i) {
      const emptyIndex = currentOrder.indexOf(puzzleSize * puzzleSize - 1);
      const [x1, y1] = [i % puzzleSize, Math.floor(i / puzzleSize)];
      const [x2, y2] = [emptyIndex % puzzleSize, Math.floor(emptyIndex / puzzleSize)];
      const isAdjacent = Math.abs(x1 - x2) + Math.abs(y1 - y2) === 1;
      if (isAdjacent) {
        [currentOrder[i], currentOrder[emptyIndex]] = [currentOrder[emptyIndex], currentOrder[i]];
        score += 10;
        scoreDisplay.textContent = score;
        generatePuzzleFromOrder();
        checkWin();
      }
    }
    function generatePuzzleFromOrder() {
      const tiles = puzzleBoard.children;
      currentOrder.forEach((val, index) => {
        const tile = tiles[index];
        tile.className = "tile";
        if (val === puzzleSize * puzzleSize - 1) {
          tile.classList.add("empty");
          tile.style.backgroundImage = "";
        } else {
          const x = val % puzzleSize;
          const y = Math.floor(val / puzzleSize);
          tile.style.backgroundImage = `url(${selectedTemplate})`;
          tile.style.backgroundSize = `${puzzleSize * 100}% ${puzzleSize * 100}%`;
          tile.style.backgroundPosition = `${(x / (puzzleSize - 1)) * 100}% ${(y / (puzzleSize - 1)) * 100}%`;
        }
      });
    }
    function checkWin() {
      if (currentOrder.every((val, i) => val === correctOrder[i])) {
        clearInterval(interval);
        document.getElementById("winPopup").style.display = "block";
        setTimeout(() => document.getElementById("winPopup").style.display = "none", 3000);
      }
    }
    function isSolvable(arr) {
      let inv = 0;
      for (let i = 0; i < arr.length - 1; i++) {
        for (let j = i + 1; j < arr.length; j++) {
          if (arr[i] > arr[j] && arr[i] !== puzzleSize * puzzleSize - 1 && arr[j] !== puzzleSize * puzzleSize - 1)
            inv++;
        }
      }
      return inv % 2 === 0;
    }
  </script>
</body>
</html>
